(function(f){f.isNumeric==null&&(f.isNumeric=function(g){return g!=null&&g.constructor===Number});f.isFunction==null&&(f.isFunction=function(g){return g!=null&&g instanceof Function});var e=f(window);var c=f(document);var b={defaultConfig:{animate:false,cellW:100,cellH:100,delay:0,engine:"giot",fixSize:null,gutterX:15,gutterY:15,keepOrder:false,selector:"> div",draggable:false,cacheSize:true,rightToLeft:false,bottomToTop:false,onGapFound:function(){},onComplete:function(){},onResize:function(){},onBlockDrag:function(){},onBlockMove:function(){},onBlockDrop:function(){},onBlockReady:function(){},onBlockFinish:function(){},onBlockActive:function(){},onBlockResize:function(){}},plugin:{},totalGrid:1,transition:false,loadBlock:function(w,p){var s=p.runtime;var v=s.gutterX;var u=s.gutterY;var i=s.cellH;var t=s.cellW;var n=null;var g=f(w);var l=g.data("active");var r=g.attr("data-position");var j=parseInt(g.attr("data-fixSize"));var h=s.lastId+++"-"+s.totalGrid;if(g.hasClass("fw-float")){return null}g.attr({id:h,"data-delay":w.index});if(p.animate&&this.transition){this.setTransition(w,"")}isNaN(j)&&(j=null);(j==null)&&(j=p.fixSize);var y=(!j)?"round":"ceil";g.attr("data-height")==null&&g.attr("data-height",g.height());g.attr("data-width")==null&&g.attr("data-width",g.width());var o=1*g.attr("data-height");var q=1*g.attr("data-width");if(!p.cacheSize){w.style.width="";q=g.width();w.style.height="";o=g.height()}var k=!q?0:Math[y]((q+v)/t);var m=!o?0:Math[y]((o+u)/i);if(!j&&p.cellH=="auto"){g.width(t*k-v);w.style.height="";o=g.height();m=!o?0:Math.round((o+u)/i)}if(!j&&p.cellW=="auto"){g.height(i*m-u);w.style.width="";q=g.width();k=!q?0:Math.round((q+v)/t)}if((j!=null)&&(k>s.limitCol||m>s.limitRow)){n=null}else{m&&m<s.minHoB&&(s.minHoB=m);k&&k<s.minWoB&&(s.minWoB=k);m>s.maxHoB&&(s.maxHoB=m);k>s.maxWoB&&(s.maxWoB=k);q==0&&(k=0);o==0&&(m=0);n={resize:false,id:h,width:k,height:m,fixSize:j};if(r){r=r.split("-");n.y=1*r[0];n.x=1*r[1];n.width=j!=null?k:Math.min(k,s.limitCol-n.x);n.height=j!=null?m:Math.min(m,s.limitRow-n.y);var x=n.y+"-"+n.x+"-"+n.width+"-"+n.height;if(l){s.holes[x]={id:n.id,top:n.y,left:n.x,width:n.width,height:n.height};this.setBlock(n,p)}else{delete s.holes[x]}}}if(g.attr("data-state")==null){g.attr("data-state","init")}else{g.attr("data-state","move")}p.onBlockReady.call(w,n,p);return(r&&l)?null:n},setBlock:function(j,r){var k=r.runtime;var q=k.gutterX;var p=k.gutterY;var o=j.height;var h=j.width;var n=k.cellH;var i=k.cellW;var m=j.x;var l=j.y;if(r.rightToLeft){m=k.limitCol-m-h}if(r.bottomToTop){l=k.limitRow-l-o}var g={fixSize:j.fixSize,resize:j.resize,top:l*n,left:m*i,width:i*h-q,height:n*o-p};g.top=1*g.top.toFixed(2);g.left=1*g.left.toFixed(2);g.width=1*g.width.toFixed(2);g.height=1*g.height.toFixed(2);j.id&&(k.blocks[j.id]=g);return g},showBlock:function(m,p){var k=p.runtime;var g=p.animate&&!this.transition?"animate":"css";var j=k.blocks[m.id];var l=f(m);var n=this;var h=l.attr("data-state")!="move";var o=h?"width 0.5s, height 0.5s":"top 0.5s, left 0.5s, width 0.5s, height 0.5s, opacity 0.5s";m.delay&&clearTimeout(m.delay);if(l.hasClass("fw-float")){return}n.setTransition(m,"");m.style.position="absolute";p.onBlockActive.call(m,j,p);function i(){h&&l.attr("data-state","start");if(p.animate&&n.transition){n.setTransition(m,o)}k.length-=1;if(!j){var q=parseInt(m.style.height)||0;var r=parseInt(m.style.width)||0;var u=parseInt(m.style.left)||0;var t=parseInt(m.style.top)||0;l[g]({left:u+r/2,top:t+q/2,width:0,height:0,opacity:0})}else{if(j.fixSize){j.height=1*l.attr("data-height");j.width=1*l.attr("data-width")}l.css({opacity:1,width:j.width,height:j.height});l[g]({top:j.top,left:j.left});if(l.attr("data-nested")!=null){n.nestedGrid(m,p)}}p.onBlockFinish.call(m,j,p);if(k.length==0){var s=p.animate?500:0;m.delay=setTimeout(function(){p.onComplete.call(m,j,p)},s)}}j&&j.resize&&p.onBlockResize.call(m,j,p);p.delay>0?(m.delay=setTimeout(i,p.delay*l.attr("data-delay"))):i()},nestedGrid:function(o,r){var k,n=f(o),j=r.runtime;var q=n.attr("data-gutterX")||r.gutterX;var p=n.attr("data-gutterY")||r.gutterY;var g=n.attr("data-method")||"fitZone";var l=n.attr("data-nested")||"> div";var m=n.attr("data-cellH")||r.cellH;var h=n.attr("data-cellW")||r.cellW;var i=j.blocks[o.id];if(i){k=new a(n);k.reset({cellH:m,cellW:h,gutterX:1*q,gutterY:1*p,selector:l,cacheSize:false});switch(g){case"fitHeight":k[g](i.height);break;case"fitWidth":k[g](i.width);break;case"fitZone":k[g](i.width,i.height);break}}},adjustBlock:function(n,i){var k=i.runtime;var l=k.gutterX;var j=k.gutterY;var h=f("#"+n.id);var g=k.cellH;var m=k.cellW;if(i.cellH=="auto"){h.width(n.width*m-l);h[0].style.height="";n.height=Math.round((h.height()+j)/g)}},adjustUnit:function(g,m,p){var o=p.gutterX;var n=p.gutterY;var i=p.runtime;var h=p.cellW;var k=p.cellH;f.isFunction(h)&&(h=h(g));h=1*h;!f.isNumeric(h)&&(h=1);f.isFunction(k)&&(k=k(m));k=1*k;!f.isNumeric(k)&&(k=1);if(f.isNumeric(g)){h<1&&(h=h*g);var l=Math.max(1,Math.floor(g/h));if(!f.isNumeric(o)){o=(g-l*h)/Math.max(1,(l-1));o=Math.max(0,o)}l=Math.floor((g+o)/h);i.cellW=(g+o)/Math.max(l,1);i.cellS=i.cellW/h;i.gutterX=o;i.limitCol=l}if(f.isNumeric(m)){k<1&&(k=k*m);var j=Math.max(1,Math.floor(m/k));if(!f.isNumeric(n)){n=(m-j*k)/Math.max(1,(j-1));n=Math.max(0,n)}j=Math.floor((m+n)/k);i.cellH=(m+n)/Math.max(j,1);i.cellS=i.cellH/k;i.gutterY=n;i.limitRow=j}if(!f.isNumeric(g)){h<1&&(h=i.cellH);i.cellW=h!=1?h*i.cellS:1;i.gutterX=o;i.limitCol=666666}if(!f.isNumeric(m)){k<1&&(k=i.cellW);i.cellH=k!=1?k*i.cellS:1;i.gutterY=n;i.limitRow=666666}i.keepOrder=p.keepOrder},resetGrid:function(g){g.blocks={};g.length=0;g.cellH=0;g.cellW=0;g.lastId=1;g.matrix={};g.totalCol=0;g.totalRow=0},setDraggable:function(j,i){var g=false;var h={startX:0,startY:0,top:0,left:0,handle:null,onDrop:function(){},onDrag:function(){},onStart:function(){}};f(j).each(function(){var s=f.extend({},h,i);var p=s.handle||this;var r=this;var m=f(r);var l=f(p);var k=m.css("position");k!="absolute"&&m.css("position","relative");function n(t){t.stopPropagation();t=t.originalEvent;if(t.touches){g=true;t=t.changedTouches[0]}if(t.button!=2&&t.which!=3){s.onStart.call(r,t);s.startX=t.clientX;s.startY=t.clientY;s.top=parseInt(m.css("top"))||0;s.left=parseInt(m.css("left"))||0;c.bind("mouseup touchend",o);c.bind("mousemove touchmove",q)}return false}function q(t){t=t.originalEvent;g&&(t=t.changedTouches[0]);m.css({top:s.top-(s.startY-t.clientY),left:s.left-(s.startX-t.clientX)});s.onDrag.call(r,t)}function o(t){t=t.originalEvent;g&&(t=t.changedTouches[0]);s.onDrop.call(r,t);c.unbind("mouseup touchend",o);c.unbind("mousemove touchmove",q)}m.find("iframe, form, input, textarea, .ignore-drag").each(function(){f(this).on("touchstart mousedown",function(t){t.stopPropagation()})});c.unbind("mouseup touchend",o);c.unbind("mousemove touchmove",q);l.unbind("mousedown touchstart").bind("mousedown touchstart",n)})},setTransition:function(j,h){var i=j.style;var g=f(j);if(!this.transition&&g.stop){g.stop()}else{if(i.webkitTransition!=null){i.webkitTransition=h}else{if(i.MozTransition!=null){i.MozTransition=h}else{if(i.msTransition!=null){i.msTransition=h}else{if(i.OTransition!=null){i.OTransition=h}else{i.transition=h}}}}}},getFreeArea:function(q,j,m){var g=Math.min(q+m.maxHoB,m.limitRow);var h=Math.min(j+m.maxWoB,m.limitCol);var k=h;var i=g;var p=m.matrix;for(var n=q;n<i;++n){for(var o=j;o<h;++o){if(p[n+"-"+o]){(j<o&&o<k)&&(k=o)}}}for(var n=q;n<g;++n){for(var o=j;o<k;++o){if(p[n+"-"+o]){(q<n&&n<i)&&(i=n)}}}return{top:q,left:j,width:k-j,height:i-q}},setWallSize:function(i,g){var j=i.totalRow;var l=i.totalCol;var o=i.gutterY;var p=i.gutterX;var n=i.cellH;var h=i.cellW;var k=Math.max(0,h*l-p);var m=Math.max(0,n*j-o);g.attr({"data-total-col":l,"data-total-row":j,"data-wall-width":Math.ceil(k),"data-wall-height":Math.ceil(m)});if(i.limitCol<i.limitRow){!g.attr("data-height")&&g.height(Math.ceil(m))}}};var d={giot:function(w,z){var A=z.runtime,m=A.limitRow,h=A.limitCol,t=0,r=0,G=A.totalCol,E=A.totalRow,D={},p=A.holes,q=null,B=A.matrix,g=Math.max(h,m),k=null,I=null,n=h<m?1:0,F=null,u=Math.min(h,m);function o(N,K,J,s,L){for(var M=K;M<K+L;){for(var i=J;i<J+s;){B[M+"-"+i]=N;++i>G&&(G=i)}++M>E&&(E=M)}}for(var C in p){if(p.hasOwnProperty(C)){o(p[C]["id"]||true,p[C]["top"],p[C]["left"],p[C]["width"],p[C]["height"])}}for(var H=0;H<g;++H){if(!w.length){break}n?(r=H):(t=H);F=null;for(var v=0;v<u;++v){if(!w.length){break}q=null;n?(t=v):(r=v);if(A.matrix[r+"-"+t]){continue}k=b.getFreeArea(r,t,A);if(z.fixSize==null){if(F&&!n&&A.minHoB>k.height){F.height+=k.height;F.resize=true;o(F.id,F.y,F.x,F.width,F.height);b.setBlock(F,z);continue}else{if(F&&n&&A.minWoB>k.width){F.width+=k.width;F.resize=true;o(F.id,F.y,F.x,F.width,F.height);b.setBlock(F,z);continue}}}if(A.keepOrder){q=w.shift();q.resize=true}else{for(var C=0;C<w.length;++C){if(w[C].height>k.height){continue}if(w[C].width>k.width){continue}q=w.splice(C,1)[0];break}if(q==null&&z.fixSize==null){for(var C=0;C<w.length;++C){if(w[C]["fixSize"]!=null){continue}q=w.splice(C,1)[0];q.resize=true;break}}}if(q!=null){if(q.resize){if(n){q.width=k.width;if(z.cellH=="auto"){b.adjustBlock(q,z)}q.height=Math.min(q.height,k.height)}else{q.height=k.height;q.width=Math.min(q.width,k.width)}}D[q.id]={id:q.id,x:t,y:r,width:q.width,height:q.height,resize:q.resize,fixSize:q.fixSize};F=D[q.id];o(F.id,F.y,F.x,F.width,F.height);b.setBlock(F,z)}else{var I={x:t,y:r,fixSize:0};if(n){I.width=k.width;I.height=0;var l=t-1;var j=r;while(B[j+"-"+l]){B[j+"-"+t]=true;I.height+=1;j+=1}}else{I.height=k.height;I.width=0;var j=r-1;var l=t;while(B[j+"-"+l]){B[r+"-"+l]=true;I.width+=1;l+=1}}z.onGapFound(b.setBlock(I,z),z)}}}A.matrix=B;A.totalRow=E;A.totalCol=G}};function a(k){var g=f(k);if(g.css("position")=="static"){g.css("position","relative")}var j=Number.MAX_VALUE;var n=this;b.totalGrid+=1;var p=f.extend({},b.defaultConfig);var l={arguments:null,blocks:{},events:{},matrix:{},holes:{},cellW:0,cellH:0,cellS:1,filter:"",lastId:0,length:0,maxWoB:0,maxHoB:0,minWoB:j,minHoB:j,running:0,gutterX:15,gutterY:15,totalCol:0,totalRow:0,limitCol:666666,limitRow:666666,sortFunc:null,keepOrder:false};p.runtime=l;l.totalGrid=b.totalGrid;var o=document.body.style;if(!b.transition){(o.webkitTransition!=null||o.MozTransition!=null||o.msTransition!=null||o.OTransition!=null||o.transition!=null)&&(b.transition=true)}function h(s){var u=l.gutterX;var r=l.gutterY;var q=l.cellH;var v=l.cellW;var i=f(s);var t=i.find(i.attr("data-handle"));b.setDraggable(s,{handle:t[0],onStart:function(w){if(p.animate&&b.transition){b.setTransition(this,"")}i.css("z-index",9999).addClass("fw-float");p.onBlockDrag.call(s,w)},onDrag:function(A,z){var x=i.position();var C=Math.round(x.top/q);var B=Math.round(x.left/v);var y=Math.round(i.width()/v);var w=Math.round(i.height()/q);C=Math.min(Math.max(0,C),l.limitRow-w);B=Math.min(Math.max(0,B),l.limitCol-y);n.setHoles({top:C,left:B,width:y,height:w});n.refresh();p.onBlockMove.call(s,A)},onDrop:function(w){var C=i.position();var E=Math.round(C.top/q);var A=Math.round(C.left/v);var z=Math.round(i.width()/v);var H=Math.round(i.height()/q);E=Math.min(Math.max(0,E),l.limitRow-H);A=Math.min(Math.max(0,A),l.limitCol-z);i.removeClass("fw-float");i.css({zIndex:"auto",top:E*q,left:A*v});var F,D,G,B;for(D=0;D<H;++D){for(F=0;F<z;++F){G=(D+E)+"-"+(F+A);B=l.matrix[G];if(B&&B!=true){f("#"+B).removeAttr("data-position")}}}l.holes={};i.attr({"data-width":i.width(),"data-height":i.height(),"data-position":E+"-"+A});n.refresh();p.onBlockDrop.call(s,w)}})}f.extend(n,{addCustomEvent:function(i,r){var q=l.events;i=i.toLowerCase();!q[i]&&(q[i]=[]);r.eid=q[i].length;q[i].push(r);return this},appendBlock:function(q){var i=f(q).appendTo(g);var s=null;var r=[];if(l.arguments){if(f.isFunction(l.sortFunc)){i.sort(l.sortFunc)}i.each(function(t,u){u.index=++t;s=b.loadBlock(u,p);s&&r.push(s)});d[p.engine](r,p);b.setWallSize(l,g);l.length=i.length;i.each(function(t,u){b.showBlock(u,p);if(p.draggable||u.getAttribute("data-draggable")){h(u)}})}},appendHoles:function(q){var r=[].concat(q),t={},s;for(s=0;s<r.length;++s){t=r[s];l.holes[t.top+"-"+t.left+"-"+t.width+"-"+t.height]=t}return this},container:g,destroy:function(){var i=g.find(p.selector).removeAttr("id"),r=null,q=[];i.each(function(t,v){$item=f(v);var u=1*$item.attr("data-width")||"";var s=1*$item.attr("data-height")||"";$item.width(u).height(s).css({position:"static"})})},fillHoles:function(q){if(arguments.length==0){l.holes={}}else{var r=[].concat(q),t={},s;for(s=0;s<r.length;++s){t=r[s];delete l.holes[t.top+"-"+t.left+"-"+t.width+"-"+t.height]}}return this},filter:function(i){l.filter=i;if(l.arguments){this.refresh()}return this},fireEvent:function(r,q,u){var t=l.events;r=r.toLowerCase();if(t[r]&&t[r].length){for(var s=0;s<t[r].length;++s){t[r][s].call(this,q,u)}}return this},fitHeight:function(i){var i=i?i:g.height()||e.height();this.fitZone("auto",i);l.arguments=arguments},fitWidth:function(i){var i=i?i:g.width()||e.width();this.fitZone(i,"auto");l.arguments=arguments},fitZone:function(r,i){var q=g.find(p.selector).removeAttr("id"),t=null,s=[];i=i?i:g.height()||e.height();r=r?r:g.width()||e.width();l.arguments=arguments;b.resetGrid(l);b.adjustUnit(r,i,p);if(l.filter){q.data("active",0);q.filter(l.filter).data("active",1)}else{q.data("active",1)}if(f.isFunction(l.sortFunc)){q.sort(l.sortFunc)}q.each(function(v,w){var u=f(w);w.index=++v;t=b.loadBlock(w,p);t&&u.data("active")&&s.push(t)});n.fireEvent("onGridReady",g,p);d[p.engine](s,p);b.setWallSize(l,g);n.fireEvent("onGridArrange",g,p);l.length=q.length;q.each(function(u,v){b.showBlock(v,p);if(p.draggable||v.getAttribute("data-draggable")){h(v)}})},fixPos:function(i){f(i.block).attr({"data-position":i.top+"-"+i.left});return this},fixSize:function(i){i.height!=null&&f(i.block).attr({"data-height":i.height});i.width!=null&&f(i.block).attr({"data-width":i.width});return this},prepend:function(i){g.prepend(i);if(l.arguments){this.refresh()}return this},refresh:function(){var q=arguments.length?arguments:l.arguments;var i=l.arguments;var r=i?i.callee:this.fitWidth;r.apply(this,Array.prototype.slice.call(q,0));return this},reset:function(i){f.extend(p,i);return this},setHoles:function(q){var r=[].concat(q),t={},s;l.holes={};for(s=0;s<r.length;++s){t=r[s];l.holes[t.top+"-"+t.left+"-"+t.width+"-"+t.height]=t}return this},sortBy:function(i){l.sortFunc=i;if(l.arguments){this.refresh()}return this},unFilter:function(){delete l.filter;this.refresh();return this}});g.attr("data-min-width",Math.floor(e.width()/80)*80);for(var m in b.plugin){if(b.plugin.hasOwnProperty(m)){b.plugin[m].call(n,p,g)}}e.resize(function(){if(l.running){return}l.running=1;setTimeout(function(){l.running=0;p.onResize.call(n,g)},122);g.attr("data-min-width",Math.floor(e.width()/80)*80)})}a.addConfig=function(g){f.extend(b.defaultConfig,g)};a.createEngine=function(g){f.extend(d,g)};a.createPlugin=function(g){f.extend(b.plugin,g)};a.getMethod=function(g){return b[g]};window.Freewall=window.freewall=a})(window.Zepto||window.jQuery);